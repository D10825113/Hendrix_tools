<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CPUID Parser Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-gray-900 font-sans min-h-screen flex flex-col">
    <div id="app" class="max-w-2xl mx-auto p-8 flex-1">
      <h1 class="text-3xl font-bold text-slate-100 mb-6">CPUID Parser Tool</h1>

      <div
        class="bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-600"
      >
        <label
          for="cpuidHex"
          class="block text-sm font-medium text-slate-300 mb-2"
        >
          Enter CPUID:
        </label>
        <input
          type="text"
          id="cpuidHex"
          v-model="cpuidInput"
          placeholder="e.g.: 806F8"
          class="w-full px-4 py-3 bg-slate-700 border border-slate-500 rounded-md text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
          @input="parseCPUID"
        />
        <!-- Error Message -->
        <div
          v-if="errorMessage"
          class="mt-4 p-3 bg-rose-900/70 border border-rose-700 rounded-md text-rose-300 text-sm"
        >
          {{ errorMessage }}
        </div>
        <!-- Calculation Process -->
        <div v-if="cpuidData && !errorMessage" class="mt-6">
          <!-- Binary Display -->
          <div class="mb-4 p-4 bg-slate-700 border border-slate-500 rounded-md">
            <h3 class="text-sm font-semibold text-slate-200 mb-2">
              Binary Representation
            </h3>
            <div class="font-mono text-sm break-all">
              <span
                v-for="(bit, index) in binaryDisplay"
                :key="index"
                :class="bit.class"
                >{{ bit.value }}</span
              >
            </div>
          </div>
          <!-- Field Parsing -->
          <div class="space-y-3">
            <div class="p-4 bg-slate-700 border border-slate-500 rounded-md">
              <h3 class="text-sm font-semibold text-slate-200 mb-2">
                Field Parsing
              </h3>
              <div class="space-y-2 text-sm text-slate-300">
                <div class="flex items-center flex-wrap sm:flex-nowrap">
                  <span
                    class="w-12 h-4 bg-yellow-600/70 inline-block mr-2 rounded flex-shrink-0"
                  ></span>
                  <span class="break-words"
                    ><strong>Stepping</strong> (Bits 0-3): {{ cpuidData.stepping
                    }}</span
                  >
                </div>
                <div class="flex items-center flex-wrap sm:flex-nowrap">
                  <span
                    class="w-12 h-4 bg-cyan-600/70 inline-block mr-2 rounded flex-shrink-0"
                  ></span>
                  <span class="break-words"
                    ><strong>Model</strong> (Bits 4-7): {{ cpuidData.model
                    }}</span
                  >
                </div>
                <div class="flex items-center flex-wrap sm:flex-nowrap">
                  <span
                    class="w-12 h-4 bg-amber-600/70 inline-block mr-2 rounded flex-shrink-0"
                  ></span>
                  <span class="break-words"
                    ><strong>Family</strong> (Bits 8-11): {{ cpuidData.family
                    }}</span
                  >
                </div>
                <div class="flex items-center flex-wrap sm:flex-nowrap">
                  <span
                    class="w-12 h-4 bg-violet-600/70 inline-block mr-2 rounded flex-shrink-0"
                  ></span>
                  <span class="break-words"
                    ><strong>Extended Model</strong> (Bits 16-19): {{
                    cpuidData.extModel }}</span
                  >
                </div>
                <div class="flex items-center flex-wrap sm:flex-nowrap">
                  <span
                    class="w-12 h-4 bg-emerald-600/70 inline-block mr-2 rounded flex-shrink-0"
                  ></span>
                  <span class="break-words"
                    ><strong>Extended Family</strong> (Bits 20-27): {{
                    cpuidData.extFamily }}</span
                  >
                </div>
              </div>
            </div>
            <!-- Step-by-Step Parsing -->
            <div class="p-4 bg-slate-700 border border-slate-500 rounded-md">
              <h3 class="text-sm font-semibold text-slate-200 mb-2">
                Step-by-Step Parsing
              </h3>
              <div class="font-mono text-sm space-y-1 text-slate-300">
                <div class="break-words">
                  <strong>Family:</strong> {{ cpuidData.fullFamily }}
                  <span class="break-all">{{ getFamilyCalculation() }}</span>
                </div>
                <div class="break-words">
                  <strong>Model:</strong> 0x{{
                  cpuidData.fullModel.toString(16).toUpperCase() }}
                  <span class="break-all">{{ getModelCalculation() }}</span>
                </div>
                <div class="break-words">
                  <strong>Stepping:</strong> {{ cpuidData.stepping }}
                </div>
              </div>
            </div>
            <!-- Result -->
            <div class="p-4 bg-slate-700 border border-slate-500 rounded-md">
              <h3 class="text-sm font-semibold text-slate-200 mb-2">Result</h3>
              <div class="font-mono text-sm space-y-1 text-slate-300">
                <div class="break-words">
                  <strong>Family-Model-Stepping: </strong>
                  <span class="break-all"
                    >{{ cpuidData.fullFamily }}-{{
                    cpuidData.fullModel.toString(16).toUpperCase() }}-{{
                    cpuidData.stepping }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const { createApp } = Vue;
      createApp({
        data() {
          return {
            cpuidInput: "",
            errorMessage: "",
            cpuidData: null,
            binaryDisplay: [],
          };
        },
        methods: {
          parseCPUID() {
            const input = this.cpuidInput.trim();
            this.errorMessage = "";
            this.cpuidData = null;
            this.binaryDisplay = [];
            if (!input) {
              return;
            }

            if (!/^[0-9a-fA-F]+$/.test(input)) {
              this.errorMessage = "âŒ Please enter a valid hexadecimal CPUID";
              return;
            }

            const cpuid = parseInt(input, 16);
            const binaryStr = cpuid.toString(2).padStart(32, "0");
            // Generate binary display
            this.generateBinaryDisplay(binaryStr);

            const stepping = cpuid & 0xf;
            const model = (cpuid >> 4) & 0xf;
            const family = (cpuid >> 8) & 0xf;
            const extModel = (cpuid >> 16) & 0xf;
            const extFamily = (cpuid >> 20) & 0xff;

            const fullFamily = family === 0xf ? family + extFamily : family;
            const fullModel =
              family === 0x6 || family === 0xf
                ? (extModel << 4) | model
                : model;

            this.cpuidData = {
              stepping,
              model,
              family,
              extModel,
              extFamily,
              fullFamily,
              fullModel,
            };
          },
          generateBinaryDisplay(binaryStr) {
            this.binaryDisplay = [];
            const colorMap = {
              stepping: "bg-yellow-600/70 text-yellow-100",
              model: "bg-cyan-600/70 text-cyan-100",
              family: "bg-amber-600/70 text-amber-100",
              extModel: "bg-violet-600/70 text-violet-100",
              extFamily: "bg-emerald-600/70 text-emerald-100",
              reserved: "bg-slate-600/70 text-slate-300",
            };

            for (let i = 0; i < 32; i++) {
              const bit = binaryStr[i];
              const bitPos = 31 - i;

              // Determine color type based on bit position
              let colorType = "reserved";
              if (bitPos >= 0 && bitPos <= 3) colorType = "stepping";
              else if (bitPos >= 4 && bitPos <= 7) colorType = "model";
              else if (bitPos >= 8 && bitPos <= 11) colorType = "family";
              else if (bitPos >= 16 && bitPos <= 19) colorType = "extModel";
              else if (bitPos >= 20 && bitPos <= 27) colorType = "extFamily";

              this.binaryDisplay.push({
                value: bit,
                class: `${colorMap[colorType]} px-1 mx-px rounded font-bold`,
              });

              // Add space every 4 bits for readability
              if ((i + 1) % 4 === 0 && i < 31) {
                this.binaryDisplay.push({ value: " ", class: "" });
              }
            }
          },

          getFamilyCalculation() {
            if (!this.cpuidData) return "";
            const { family, extFamily } = this.cpuidData;
            return family === 0xf
              ? `(${family} + ${extFamily})`
              : "(Use Family value directly)";
          },

          getModelCalculation() {
            if (!this.cpuidData) return "";
            const { family, model, extModel } = this.cpuidData;
            return family === 0x6 || family === 0xf
              ? `((${extModel} << 4) | ${model})`
              : "(Use Model value directly)";
          },
        },
      }).mount("#app");
    </script>
    <!-- Footer -->
    <footer class="bg-slate-800 border-t border-slate-600 py-6 mt-auto">
      <div class="max-w-2xl mx-auto px-8 text-center">
        <p class="text-slate-400 text-sm">
          Created by <span class="text-slate-200 font-medium">Chad</span>
        </p>
      </div>
    </footer>
  </body>
</html>
